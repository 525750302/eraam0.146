;-------------------------------------------------
;時間を進ませないコマンドの場合の@SOURCE_CHECK
;基本的にはソース変動と刻印＆経験取得、セリフのみ
;-------------------------------------------------
@SOURCE_CHECK_SHORT
#DIM LCOUNT
;-------------------------------------------------
;調教コマンドのフラグ取得
;-------------------------------------------------
CALL CALC, "調教のフラグ取得"
;-------------------------------------------------
;～快楽経験発生フラグ
;-------------------------------------------------
CALL SETFLAG, "快楽経験判定", SELECTCOM
;-------------------------------------------------
;バイブなど付けっぱなしアイテムのチェック(主にSOURCE計算。快楽のSOURCEが増えないものは、ここにはなくても良い)
;-------------------------------------------------
CALL EQUIP_1
;-------------------------------------------------
;SOURCE計算
;-------------------------------------------------
CALL CALC_SOURCE
;-------------------------------------------------
;絶頂処理(見込み)
;-------------------------------------------------
CALL ORGASM_ADD_A
;-------------------------------------------------
;刻印取得のチェック(見込み)
;-------------------------------------------------
CALL MARK_GOT_CHECK
;-------------------------------------------------
;コマンド実行時の口上
;-------------------------------------------------
;刻印取得口上を喋ったなら、コマンド口上は飛ばす(後で仕組みを作る)
IF 0
ELSE
	CALL KOJO_MESSAGE_COM
ENDIF
;-------------------------------------------------
;各種経験の変動
;-------------------------------------------------
CALL GET_EXP_COM
;-------------------------------------------------
;口上(@KOJO_MESSAGE_COM)による強制終了
;-------------------------------------------------
SIF NEXTCOM == 999
	RETURN 0
;-------------------------------------------------
;コマンドによるムードの獲得
;-------------------------------------------------
CALL MOOD_COM, SELECTCOM
;-------------------------------------------------
;特別経験獲得_1
;-------------------------------------------------
CALL RECORD_SP_EXP_ALLACTOR
;-------------------------------------------------
;助手の行動
;-------------------------------------------------
CALL EVENT_ASSI_AUTO, "調教中"
;-------------------------------------------------
;バイブなど付けっぱなしアイテムのチェック(テキストと経験)
;-------------------------------------------------
CALL EQUIP_2
;-------------------------------------------------
;アドバイザー能力発動
;-------------------------------------------------
CALL TURN_BONUS_ADVISER
;-------------------------------------------------
;おもな経験の増加が一段落下ところで技能ＬＶチェック
;-------------------------------------------------
CALL GET_EXABL2, TARGET
CALL GET_EXABL2, MASTER
CALL GET_EXABL2, ASSI
;-------------------------------------------------
;特別経験獲得_2
;-------------------------------------------------
CALL RECORD_SP_EXP_ALLACTOR
;-------------------------------------------------
;絶頂処理、パートナーの射精＆噴乳チェック（ふたなり・オトコ）
;-------------------------------------------------
;手加減している時には止めるか選択させる？
CALL ORGASM_ADD_A
CALL ORGASM_ADD_B
;-------------------------------------------------
;特別経験獲得_3
;-------------------------------------------------
CALL RECORD_SP_EXP_ALLACTOR
;-------------------------------------------------
;NEW_UPCHECKの直接記述コマンド対応用
;-------------------------------------------------
FOR LCOUNT, 1, CHARANUM
	SELECTCASE LCOUNT
	CASE PLAYER, PLAYER:1, MASTER, ASSI
		;精力が減少している
		SIF BASE:LCOUNT:精力 < TCVAR:LCOUNT:精力開始前
			TCVAR:LCOUNT:精力減少 = TCVAR:LCOUNT:精力開始前 - BASE:LCOUNT:精力
	ENDSELECT
NEXT
;-------------------------------------------------
;絶頂メッセージの表示
;-------------------------------------------------
CALL TRAIN_MESSAGE_A
;-------------------------------------------------
;パラメータ変動による口上(TARGETの絶頂など)
;-------------------------------------------------
CALL KOJO_MESSAGE_PALAMCNG
;口上による強制終了
SIF NEXTCOM == 999
	RETURN 0
;-------------------------------------------------
;射精・絶頂判定
;-------------------------------------------------
CALL SAMEN_AND_EXTACY
;-------------------------------------------------
;SOURCE計算
;-------------------------------------------------
CALL CALC_SOURCE
;-------------------------------------------------
;PLAYERの射精＆絶頂をトリガーにした口上
;-------------------------------------------------
CALL KOJO_MESSAGE_SAMEN_AND_EXTACY
;口上による強制終了
SIF NEXTCOM == 999
	RETURN 0
;-------------------------------------------------
;PLAYERの射精＆絶頂をトリガーにした口上（３Ｐ）
;-------------------------------------------------
CALL KOJO_MESSAGE_SAMEN_AND_EXTACY_3P
;口上による強制終了
SIF NEXTCOM == 999
	RETURN 0

;-------------------------------------------------
;パートナーの状態（陥没乳首の勃起など）チェック
;-------------------------------------------------
CALL TARGET_FLAG_CHECK
;-------------------------------------------------
;被虐快楽経験、奉仕快楽経験等のチェック
;-------------------------------------------------
CALL EXP_GOT_CHECK
;-------------------------------------------------
;主人による調教の経験値
;-------------------------------------------------
CALL MASTER_FLAG_CHECK
;-------------------------------------------------
;刻印取得のチェック(@KOJO_MESSAGE_MARKCNG は@MARK_GOT_CHECK 内にある)
;-------------------------------------------------
CALL MARK_GOT_CHECK
;口上による強制終了
SIF NEXTCOM == 999
	RETURN 0
;-------------------------------------------------
;特別経験獲得_4
;-------------------------------------------------
CALL RECORD_SP_EXP_ALLACTOR
;-------------------------------------------------
;調教ソースの表示
;-------------------------------------------------
CALL SHOW_SOURCE
;-------------------------------------------------
;体力の減少
;-------------------------------------------------
SIF TALENT:Ｖ損傷 || TALENT:Ａ損傷
	CALL PRINT_STR, "黄色_ ＜体内損傷中＞_L"
CALL CALC, "体力減少"
;体力の変動を表示
IF DOWNBASE:体力
	IF DOWNBASE:体力 > 0
		LOCALS = イエロー_体力-{ABS(DOWNBASE:体力)}
	ELSE
		LOCALS = 粉紅_体力+{ABS(DOWNBASE:体力)}
	ENDIF
	CALL PRINT_STR, LOCALS
ENDIF
PRINTFORML \@ COND("疲労") ? ★疲労困憊★ # \@
;-------------------------------------------------
;非参加者の体力の回復
;-------------------------------------------------
FOR LCOUNT, 2, CHARANUM
	SIF DOWNBASE:LCOUNT:体力 > 0
		CONTINUE

	BASE:LCOUNT:体力 = LIMIT(BASE:LCOUNT:体力 + 20 + RAND:81, 0, MAXBASE:LCOUNT:体力)
NEXT
;-------------------------------------------------
;テキストの表示
;-------------------------------------------------
CALL TEXT_TURNEND
;-------------------------------------------------
;SOURCE計算
;-------------------------------------------------
CALL CALC_SOURCE
;-------------------------------------------------
;刻印取得のチェック
;-------------------------------------------------
CALL MARK_GOT_CHECK
;-------------------------------------------------
;パラメータの上昇＆表示（CDOWNもここで）
;-------------------------------------------------
CALL NEW_UPCHECK

;-------------------------------------------------
;イベントフラグをリセット
;-------------------------------------------------
CVARSET TCVAR, GETNUM(TCVAR, "イベント")
;-------------------------------------------------
;フラグに使う現実時間を取得
;-------------------------------------------------
CALL GET_REALTIMEFORFLAG

WAIT
